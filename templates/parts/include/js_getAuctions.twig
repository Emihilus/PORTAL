
//window.onbeforeunload = function () { }

if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
    alert('Got here using the browser "Back" or "Forward" button.');
}
else
	window.onLoad = getAuctions({{app.request.get('page')}});
	
window.onpopstate = function (e) 
{
   processSuccess(localStorage.getItem('getAuctionsResponse'));         
   
}


function onChangeHandler (selectedObject)
{
	$.ajax({
		url: "{{path ('setPerPage') }}",
		method: "post", 
		dataType: "json", 
		data: { 
			itemsPerPage: selectedObject
    }
	})
	.done(res => 
	{ 
		console.log(res);
		getAuctions(1);
		//location.reload();
	});
}

function getAuctions(requestedPage)
{
	GAJArray.requestedPage = requestedPage;
    $.ajax({
   	 	url: "{{path ('getAuctions') }}",
    	method: "post", 
    	dataType: "html", 
    	data: JSON.stringify(GAJArray) })
	.done(res => 
	{ 
		localStorage.setItem("getAuctionsResponse", res);
		processSuccess(res);
		//window.history.pushState('page2', 'Title', historyString+requestedPage);
	});

	function processSuccess(res)
	{
		if(res == 'none')
		{
			$('#list-content').html("No auctions");
			return;
		}

		$('#contener').html(res);


		let pageElementsArray = $('.page-item').toArray();
		pageElementsArray.forEach(function (pageItemElement) 
		{
			if(requestedPage == pageItemElement.children[0].innerHTML)
				$(pageItemElement).addClass('active');
			else
				$(pageItemElement).removeClass('active');

			if(pageItemElement.children[0].innerHTML == 'Previous' && requestedPage == 1)
				$(pageItemElement).addClass('disabled');
			else if(pageItemElement.children[0].innerHTML == 'Previous' && requestedPage > 1)
			{
				$(pageItemElement).removeClass('disabled');
				pageItemElement.children[0].setAttribute('onclick','getAuctions('+(requestedPage-1)+')');
			}
			
			if(pageItemElement.children[0].innerHTML == 'Next' && requestedPage == pageElementsArray.length-2)
				$(pageItemElement).addClass('disabled');
			else if(pageItemElement.children[0].innerHTML == 'Next' && requestedPage < pageElementsArray.length-2)
			{
				$(pageItemElement).removeClass('disabled');
				pageItemElement.children[0].setAttribute('onclick','getAuctions('+(requestedPage+1)+')');
			}
		});
	}
}