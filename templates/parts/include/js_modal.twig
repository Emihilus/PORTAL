let optionsClicked = false;
    var clickedId;

    function task(clickedAId)
    {
        optionsClicked = true;
        this.clickedId = clickedAId;
        $('#exampleModalCenter').modal('show')
    }

    function link(link)
    {
        if(!optionsClicked)
            window.location.href = link;
    }

    $('#exampleModalCenter').on('hidden.bs.modal', function (e) 
    {
        optionsClicked = false;
        {% if app.user %}$('.modal-body').html('Choose your action');{% endif %}
    })

    function deleteAuction()
    {
        {# console.log(clickedId); #}
        $('.modal-body').html('EXECUTING...');

         fetch("{{path('deleteAuction')}}", 
         {
            method: 'POST',
            body: JSON.stringify({
            'auctionId' : clickedId
            })
        })
        .then((response) => 
        {
            response.json().then(function(json)
            {
                {# console.log(json); #}
                $('.modal-body').html(json.result);

                if(json.result == 'Success')
                    {
                        $('#aid-'+clickedId).toggleClass('d-none');
                        setTimeout(() => {$('#exampleModalCenter').modal('hide')}, 600);
                    }
            });
        })
        .catch(() => { /* Error. Inform the user */ })
                
    }

    function endNowAuction()
    {
        {# console.log(clickedId); #}
        $('.modal-body').html('EXECUTING...');

         fetch("{{path('endNowAuction')}}", 
         {
            method: 'POST',
            body: JSON.stringify({
            'auctionId' : clickedId
            })
        })
        .then((response) => 
        {
            response.json().then(function(json)
            {
                {# console.log(json); #}
                $('.modal-body').html(json.result);

                if(json.result == 'Success')
                    {
                        $('#aid-'+clickedId).toggleClass('text-secondary');
                        setTimeout(() => {$('#exampleModalCenter').modal('hide')}, 600);
                    }
            });
        })
        .catch(() => { /* Error. Inform the user */ })
                
    }

    function toggleFavorite(clickedAId)
    {
        let add;
        if($("#fid_"+clickedAId).attr('src').includes('favd.png'))
        {
            add = true;
        }
        else
        {
            add = false;
        }

        optionsClicked = true;
        this.clickedId = clickedAId;

        if({% if not app.user %}true{% else %}false{% endif %})
        {
            $('#exampleModalCenter').modal('show');
            return;
        }

        fetch("{{path('toggleFavoriteAuction')}}", 
        {
           method: 'POST',
           body: JSON.stringify({
           'auctionId' : clickedAId,
           add
           })
       })
       .then((response) => 
       {
           response.json().then(function(json)
           {
               //console.log(json);
               if(json.result == 'Success')
                   {
                       //console.log('entered' + add);
                       add ? $("#fid_"+clickedAId).attr('src', $("#fid_"+clickedAId).attr('src').replace('favd.png', 'fave.png')) : $("#fid_"+clickedAId).attr('src', $("#fid_"+clickedAId).attr('src').replace('fave.png', 'favd.png'));

                       optionsClicked = false;
                       setTimeout(() => {$('#exampleModalCenter').modal('hide')}, 1100);
                   }
           });
       })
       .catch(() => { /* Error. Inform the user */ })
    }