<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>
			{% block title %}
				- PDAPW.PL
			{% endblock %}
		</title>
		{# Run `composer require symfony/webpack-encore-bundle`
				           and uncomment the following Encore helpers to start using Symfony UX #}
		{% block stylesheets %}
			<!-- CSS only -->
			<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

			<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&amp;subset=latin-ext" rel="stylesheet">


			{{ encore_entry_link_tags('app') }}

		{% endblock %}


	</head>
	<body>
		{% block header %}
			<header>
				<nav class="navbar navbar-dark bg-primary navbar-expand-md">
					<a class="navbar-brand ms-1" href="/">
						<img class="d-none d-md-inline-block align-bottom" src="{{asset('img/logo.png')}}" width="30" height="30" alt=""/>
						<span>PDPAPW.PL</span>
					</a>

					<!-- <p class="d-inline-block mb-0">Skoki.pl</p> -->

					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainmenu">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="mainmenu">
						<ul class="navbar-nav me-auto">
							<li class="nav-item">
								<a class="nav-link {% if app.request.attributes.get('_route') == 'auction-list' %}active{% endif %}" href="/">Aukcje</a>
							</li>
							<li class="nav-item dropdown">
								<a class="nav-link d-none dropdown-toggle" data-bs-toggle="dropdown" role="button" href="#">Nested</a>

								<div class="dropdown-menu">
									<a class="dropdown-item">Terminarz zawoduw</a>
									<a class="dropdown-item">Organizator</a>

									<div class="dropdown-divider"></div>

									<a class="dropdown-item">Zaradkiewicz</a>
									<a class="dropdown-item">Telestry</a>
								</div>

							</li>
							<li class="nav-item">
								<a class="nav-link {% if app.request.attributes.get('_route') == 'create-auction' %}active{% endif %}" href="{{path('create-auction')}}">Stwórz aukcję</a>
							</li>
							<li class="nav-item">
								<a class="nav-link {% if app.request.attributes.get('_route') == 'users-list' %}active{% endif %}" href="{{path('users-list')}}">Users list</a>
							</li>

							{% if not app.user %}
								<li class="nav-item">
									<a class="nav-link active" href="
																												{{path('app_login')}}">Log in</a>
								</li>
								<li class="nav-item">
									<a class="nav-link active" href="
																												{{path('app_register')}}">Register</a>
								</li>
							{% else %}
								<li class="nav-item">
									<a class="nav-link active" href="
																														{{path('my-profile')}}">
										<b>{{app.user.username}}</b>
									</a>
								</li>

								<li class="nav-item">
									<a class="nav-link active" href="
																												{{path('app_logout')}}">Logout</a>
								</li>
							{% endif %}
						</ul>

						<form class="d-none d-flex me-1">
							<input type="text" class="form-control me-1" placeholder="First name" aria-label="First name">
							<button class="btn btn-light" type="submit">Znajdź</button>
						</form>

					</div>

					<div class="icon" id="bell">
						<img src="https://i.imgur.com/AC7dgLA.png" alt="">

					<span id="notifCount" class="position-absolute badge badge-danger">1</span>
					</div>
					<div class="notifications" id="box">
						
					</div>

				</nav>


			</header>
		{% endblock %}

		{% for label,messages in app.flashes %}

			{% for message in messages %}

				<div class="alert alert-{{label}}" role="alert">
					{{ message|trans }}
				</div>

			{% endfor %}

		{% endfor %}

		<div class="container"> {% block body %}{% endblock %}
			</div>

			<!-- Footer -->
			<footer
				class="text-center text-lg-start bg-light text-muted">
				<!-- Copyright -->
				<div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
					© 1993 KOPYRAJT-ORAJT:
					<a class="text-reset fw-bold" href="https://github.com/Emihilus/">emazemhs.com</a>
				</div>
				<!-- Copyright -->
			</footer>
			<!-- Footer -->

		</body>

		{% block javascripts %}
			{{ encore_entry_script_tags('app') }}
			<!-- JavaScript Bundle with Popper -->
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
			<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
			<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
			<link
			rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

			<script>
			$(document).ready(function()
			{

				var down = false;

				$('#bell').click(function(e)
				{

					var color = $(this).text();
					if(down)
					{

						$('#box').css('height','0px');
						$('#box').css('opacity','0');
						down = false;
					}
					else
					{
						markNotificationsAsRead();
						$('#box').css('height','auto');
						$('#box').css('opacity','0.95');
						down = true;
					}

				});
			getNotifications();
			});

			function getNotifications()
			{
				$.ajax({
					url: "{{path ('get-notifications-dm') }}",
					method: "post", 
					dataType: "json"})
				.done(res => 
				{ 
					console.log(res)
					$("#box").html(res.render);
					$("#notifCount").html(res.notifCount)
				});
			}

			function markNotificationsAsRead()
			{
				$.ajax({
					url: "{{path ('mar-notifications') }}",
					method: "post", 
					dataType: "html"})
				.done(res => 
				{ 
					console.log(res);
				});
			}

			</script>

		{# <script src="{{asset('dist/dropzone.js')}}"></script> #}


		{% endblock %}

	</html>

	{#  
		from auction details
		
		/*  ABADON FETCH
		   fetch(url, {
		    method: 'POST',
		    headers: {
		        'Content-Type': 'application/json',
		        },
		    body: JSON.stringify({'offerValue': offerValue*100, // moze byc samo offerValue przekaze offervalue:value
		            'auctionId' : {{auction.id}} }) 
		        })
		    .then((response) => 
		    {
		        let container = document.createElement('div');
		        container.innerHTML = '<b>Emis offers '+offerValue+' PLN</b> triggered at date <br>';
		        document.getElementById('offers').prepend(container);
		      console.log(response)
		      response.json().then(function(data) {
		        console.log(data);
		      });
		    })
		    .catch(() => { /* Error. Inform the user */ /*})
		
		     fetch(url, {
		    method: 'POST',
		    headers: {
		        'Content-Type': 'application/json',
		        },
		    body: JSON.stringify({'offerValue': offerValue*100, // moze byc samo offerValue przekaze offervalue:value
		            'auctionId' : {{auction.id}} }) 
		        })
		    .then((response) => json())
		    .then((response) => 
		    {
		        let container = document.createElement('div');
		        container.innerHTML = '<b>Emis offers '+offerValue+' PLN</b> triggered at date <br>';
		        document.getElementById('offers').prepend(container);
		
		       //y var jsson = JSON.parse(response);
		        console.log("WHOLE RESPONSE: "+response)
		
		        console.log("RESPONSE ERRORSBODY: "+response[0]);
		
		       /* response.json().then(function(data) 
		        {
		            console.log("RESP JSON: "+data);
		      });*//*
		    })
		    .catch(() => { /* Error. Inform the user *//* })*/
		}
		
		
		
		
		/*function secondsToHmsCut(d) { useful
		    d = Number(d);
		    let h = Math.floor(d / 3600);
		    let m = Math.floor(d % 3600 / 60);
		    let s = Math.floor(d % 3600 % 60);
		
		    let hDisplay = h > 0 ? h + (h == 1 ? " hour, " : " hours, ") : "";
		    let mDisplay = m > 0 ? m + (m == 1 ? " minute, " : " minutes, ") : "";
		    let sDisplay = s > 0 ? s + (s == 1 ? " second" : " seconds") : "";
		    return hDisplay + mDisplay + sDisplay; 
		}*/ #}
