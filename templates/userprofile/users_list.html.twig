{% extends 'base.html.twig' %}

{% block title %}Users list{{ parent() }}{% endblock %}

{% block body %}
<h1>Users list</h1>

{% for user in users %}
    {{user}} <a href="{{path('user-auctions',{username: user} )}}">show auctions</a> 

    {# admin options section #}
    {% if true %}
    | is Verified? {% if user.isVerified == 1 %}<b id="vs-{{user}}" class="text-success">yes</b> <a id="li-{{user}}" href='#' onclick="toggleVerification('{{user}}',true)">cancel verification</a>{% else %}<b id="vs-{{user}}" class='text-danger'>no</b> <a id="li-{{user}}" href='#' onclick="toggleVerification('{{user}}',false)">verify</a>{% endif %} | 
    is Banned? <b class="text-success">no</b> <a href='#'>BAN</a> 
    {% endif %}
    {# admin options section #}
    
    <hr>
{% endfor %}

<pre>
    {{ dump(users) }}
</pre>
{% endblock %}

{% block javascripts %}
{{ parent() }}

<script>
function toggleVerification(username, action)
{
        fetch("{{path('toggleVerification')}}", 
        {
            method: 'POST',
            body: JSON.stringify(
                {
                    action,
                    username
                })
        })
        .then((response) => 
        {
            response.json().then(function(json)
            {
                if(json.result == 'Success')
                {
                    $("#vs-"+username).toggleClass('text-danger');
                    $("#vs-"+username).toggleClass('text-success');
                    if(action)
                    {
                        $("#vs-"+username).html('no');
                        $("#li-"+username).attr('onclick', 'toggleVerification("'+username+'",false)');
                        $("#li-"+username).html('verify');
                    }
                    else
                    {
                        $("#vs-"+username).html('yes');
                        $("#li-"+username).attr('onclick', 'toggleVerification("'+username+'",true)');
                        $("#li-"+username).html('cancel verification');
                    }
                }

            });
        })
        .catch(() => { /* Error. Inform the user */ })
}
</script>
{% endblock %}