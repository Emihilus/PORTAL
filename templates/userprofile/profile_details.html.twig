{% extends 'base.html.twig' %}

{% block title %}User {{USR[0][0].username}}{{ parent() }}{% endblock %}

{% block body %}
<h1>Details of user {{USR[0][0].username}}</h1>
Number of auctions issued by this user : <b>{% if USR[0]['Auctions_Issued'] != 0 %}{{USR[0]['Auctions_Issued']}}{% else %}No auctions{% endif %} </b> <a href="{{path('user-auctions', {'username': USR[0][0].username})}}">--->Show</a><br>
Leading in the following number of aucions : {{USR[0]['Leading_In']}} {#<a href="{{path('user-auctions', {'username': USR})}}">--->Show</a>#}<br>
Number of auctions the user is participating in  : {{USR[0]['Participating_In']}} {#<a href="{{path('user-auctions', {'username': USR})}}">--->Show</a>#}<br>
All issued offers : {{USR[0]['All_Offers']}}

<pre>
    {{ dump(USR) }}
</pre>

{% endblock %}


{# SELECT auctions.id, username, (SELECT offers.id FROM offers) as leads FROM users left join auctions on users.id=auctions.by_user_id WHERE users.username = 'Emis' GROUP by auctions.id #}

{# SELECT users.id, users.username, 
(SELECT COUNT(*) FROM auctions WHERE by_user_id=1) Auctions_Issued, 
(SELECT COUNT(*) FROM offers WHERE by_user_id=1) All_Offers,
(SELECT COUNT(DISTINCT offers.auction_id) FROM offers WHERE by_user_id=1) Participating_In

FROM users  

WHERE users.id = 1 #}


{# SELECT users.id, users.username, 
(SELECT COUNT(*) FROM auctions WHERE by_user_id=1) Auctions_Issued, 
(SELECT COUNT(*) FROM offers WHERE by_user_id=1) All_Offers ,
(SELECT COUNT(DISTINCT offers.auction_id) FROM offers WHERE by_user_id=1) Participating_In,

(SELECT COUNT(DISTINCT auctions.id) FROM auctions
RIGHT JOIN 
 (SELECT DISTINCT ada.auction_id FROM offers ada where ada.by_user_id=1 and ada.value=(select max(t2.value) from offers t2 where t2.id=ada.id)) ofers
 ON auctions.id=ofers.auction_id ) Leading_In

FROM users  

WHERE users.id = 1 #}

{# SELECT users.id, users.username, 
(SELECT COUNT(*) FROM auctions WHERE by_user_id=1) Auctions_Issued, 
(SELECT COUNT(*) FROM offers WHERE by_user_id=1) All_Offers ,
(SELECT COUNT(DISTINCT offers.auction_id) FROM offers WHERE by_user_id=1) Participating_In,

(SELECT COUNT(DISTINCT auctions.id) FROM auctions
RIGHT JOIN 
 (SELECT DISTINCT ada.auction_id FROM offers ada where ada.by_user_id=1 and ada.value=(select max(t2.value) from offers t2 where t2.id=ada.id)) ofers
 ON auctions.id=ofers.auction_id ) Leading_In

FROM users  

WHERE users.id = 1 #}

{# WORKING:
SELECT users.id, users.username, 
(SELECT COUNT(*) FROM auctions WHERE by_user_id=1) Auctions_Issued, 
(SELECT COUNT(*) FROM offers WHERE by_user_id=1) All_Offers ,
(SELECT COUNT(DISTINCT offers.auction_id) FROM offers WHERE by_user_id=1) Participating_In,

(SELECT COUNT(*)
FROM offers ofUP
WHERE value=(SELECT max(value) FROM offers ofNE WHERE ofNE.auction_id=ofUP.auction_id)
AND by_user_id=1) Leading_In

FROM users  

WHERE users.id = 1 #}